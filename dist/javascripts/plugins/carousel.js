define(["exports"],function(t){"use strict";function i(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var e=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),s={count:1,slideTime:.25,autoTimer:0,reverse:!0,width:void 0,height:void 0,direction:"horizontal",isLoop:!1,autoHide:"hide",prevBtn:void 0,nextBtn:void 0,index:0,pagination:!0,mousewheel:!1,preSlideFn:null,startSlideFn:null,callback:null},n=function(){function t(e,n){i(this,t),Object.assign(this,s,n),this.itemIndex=this.isLoop?this.count+this.index:this.index,this.isScroll=!1,this.events=[],this.init(e)}return e(t,[{key:"init",value:function(t){this.elem=t,this.prevBtn=this.prevBtn?document.querySelector(this.prevBtn):t.querySelector(".carousel-prevBtn"),this.nextBtn=this.nextBtn?document.querySelector(this.nextBtn):t.querySelector(".carousel-nextBtn"),this.wrap=t.querySelector(".carousel-wrap"),this.items=Array.from(this.wrap.querySelectorAll(".carousel-slide")),this.total=this.items.length,this.elem.classList.add("horizontal"===this.direction?"carousel-horizontal":"carousel-vertical"),this.initSize(),this.isLoop&&this.addSlide(),this.pagination&&this.createPagination(),this.initPos(),this.autoHide&&this.autoHideBtn()}},{key:"initSize",value:function(){var t=this;this.width&&(this.elem.style.width="number"==typeof this.width?this.width+"px":this.width),this.height&&(this.elem.style.height="number"==typeof this.height?this.height+"px":this.height),this.itemSize=100/this.count+"%",Array.from(this.items,function(i){return i.style["flex-basis"]=t.itemSize})}},{key:"addSlide",value:function(){for(var t=this,i=this.items.slice(this.total-this.count),e=i.length-1;e>=0;e--)this.wrap.insertBefore(i[e].cloneNode(!0),this.wrap.firstChild);Array.from(this.items.slice(0,this.count),function(i){return t.wrap.appendChild(i.cloneNode(!0))})}},{key:"initPos",value:function(){this.pos=-this.itemIndex,this.bindEvent(),this.setPosition(),this.setTransitionTime(this.slideTime)}},{key:"eventControl",value:function(t,i,e){var s;"mousewheel"===i&&void 0!==document.mozHidden&&(i="DOMMouseScroll");for(var n=arguments.length,o=Array(n>3?n-3:0),h=3;h<n;h++)o[h-3]=arguments[h];e=(s=e).bind.apply(s,[this].concat(o)),t.addEventListener(i,e,!1),this.events.push(function(){return t.removeEventListener(i,e,!1)})}},{key:"bindEvent",value:function(){var t=this;this.prevBtn&&this.eventControl(this.prevBtn,"click",this.slidePrev),this.nextBtn&&this.eventControl(this.nextBtn,"click",this.slideNext),this.mousewheel&&this.eventControl(this.wrap,"mousewheel",this.scrollSlide),this.eventControl(this.wrap,"transitionend",this.slideEnd),this.autoTimer&&(this.timer=setInterval(function(){return t.slide(t.reverse?1:-1,"auto")},this.autoTimer))}},{key:"destoryEvent",value:function(){for(;this.events.length;)this.events.shift()()}},{key:"destory",value:function(){this.destoryEvent(),this.elem.parentNode.removeChild(this.elem)}},{key:"slide",value:function(t,i){if(!t||this.isScroll)return!1;if(this.preSlideFn&&!this.preSlideFn(this))return!1;if("click"===i&&(clearInterval(this.timer),this.timer=null),!this.isLoop){var e=this.itemIndex-t;if(e>=this.total||e<0)return!1}this.index-=t,this.itemIndex-=t,this.pos=this.pos+t,this.isScroll=!0,this.setPosition(),this.pagination&&this.setPaginationActive(),this.autoHide&&this.autoHideBtn(),this.startSlideFn&&this.startSlideFn(this)}},{key:"slidePrev",value:function(){this.slide(1,"click")}},{key:"slideNext",value:function(){this.slide(-1,"click")}},{key:"scrollSlide",value:function(t){var i=this,e=void 0,s=t.type;return"DOMMouseScroll"!=s&&"mousewheel"!=s||(e=t.wheelDelta?t.wheelDelta/120:-(t.detail||0)/3),(this.isScroll||this.isLoop||!this.isLoop&&(this.itemIndex!==this.total-this.count&&e<0||0!==this.itemIndex&&e>0))&&t.preventDefault(),1===+this.mousewheel?this.slide(e,"click"):void(this.mousewheelTimer?(this.curDelta+=e,this.curDelta===e*+this.mousewheel&&this.slide(e,"click")):(this.curDelta=e,this.mousewheelTimer=setTimeout(function(){i.curDelta=0,i.mousewheelTimer=null},300)))}},{key:"slideTo",value:function(t){return t=(t+this.total)%this.total,t!==this.index&&void this.slide(this.index-t,"click")}},{key:"slideEnd",value:function(){var t=this;this.autoTimer&&!this.timer&&(this.timer=setInterval(function(){return t.slide(t.reverse?1:-1,"auto")},this.autoTimer));var i=this.isEnd();this.isLoop&&i&&(1===i?(this.pos=-this.total,this.itemIndex=this.total,this.index=this.total-1):(this.pos=-this.count,this.itemIndex=this.count,this.index=0),this.setTransitionTime(0),this.setPosition(),this.elem.offsetWidth,this.setTransitionTime(this.slideTime)),this.isScroll=!1,this.callback&&this.callback(this)}},{key:"setPosition",value:function(){var t=this.pos*(100/this.count),i="horizontal"===this.direction?"translate3d("+t+"%, 0%, 0)":"translate3d(0%, "+t+"%, 0)";this.wrap.style.transform=i,this.wrap.style.webkitTransform=i}},{key:"setTransitionTime",value:function(t){this.wrap.style.transitionDuration=t+"s",this.wrap.style.webkitTransitionDuration=t+"s"}},{key:"autoHideBtn",value:function(){!this.isLoop&&this.autoHide&&(this.itemIndex===this.total-this.count&&this.nextBtn&&this.nextBtn.classList.add("hide"),0===this.itemIndex&&this.prevBtn&&this.prevBtn.classList.add("hide"),this.itemIndex>0&&this.prevBtn&&this.prevBtn.classList.remove("hide"),this.itemIndex<this.total-this.count&&this.nextBtn&&this.nextBtn.classList.remove("hide"))}},{key:"isEnd",value:function(){return 0===this.itemIndex?1:this.itemIndex===this.total+this.count?2:0}},{key:"createPagination",value:function(t){this.pages=document.createElement("UL"),this.pages.className="carousel-pagination"+("string"==typeof this.pagination?" "+this.pagination:"");for(var i="",e=0;e<this.total;e++)i+='<li class="carousel-pagination-bullet"></li>';this.pages.innerHTML=i,this.elem.appendChild(this.pages),this.eventControl(this.pages,"click",this.clickPagination),this.curBullet=this.pages.children[this.index],this.curBullet.classList.add("carousel-pagination-bullet-active")}},{key:"setPaginationActive",value:function(){this.curBullet.classList.remove("carousel-pagination-bullet-active"),this.curBullet=this.pages.children[(this.index+this.total)%this.total],this.curBullet.classList.add("carousel-pagination-bullet-active")}},{key:"clickPagination",value:function(t){var i=t.target;if(!i.classList.contains("carousel-pagination-bullet"))return!1;i=i.previousSibling;for(var e=0;i;)i=i.previousSibling,e++;this.slideTo(e)}}]),t}(),o=function(t,i){function e(t){return t.carousel?t.carousel:t.carousel=new n(t,i)}var s=document.querySelectorAll(t);return console.log(t),1===s.length?e(s[0]):Array.from(s,e)};t["default"]=o});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBsdWdpbnMvY2Fyb3VzZWwuanMiXSwibmFtZXMiOlsiZGVmaW5lIiwiZXhwb3J0cyIsIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInZhbHVlIiwiX2NyZWF0ZUNsYXNzIiwiZGVmaW5lUHJvcGVydGllcyIsInRhcmdldCIsInByb3BzIiwiaSIsImxlbmd0aCIsImRlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJwcm90b3R5cGUiLCJfZGVmYXVsdCIsImNvdW50Iiwic2xpZGVUaW1lIiwiYXV0b1RpbWVyIiwicmV2ZXJzZSIsIndpZHRoIiwidW5kZWZpbmVkIiwiaGVpZ2h0IiwiZGlyZWN0aW9uIiwiaXNMb29wIiwiYXV0b0hpZGUiLCJwcmV2QnRuIiwibmV4dEJ0biIsImluZGV4IiwicGFnaW5hdGlvbiIsIm1vdXNld2hlZWwiLCJwcmVTbGlkZUZuIiwic3RhcnRTbGlkZUZuIiwiY2FsbGJhY2siLCJDYXJvdXNlbCIsImVsZW0iLCJvcHRpb24iLCJ0aGlzIiwiYXNzaWduIiwiaXRlbUluZGV4IiwiaXNTY3JvbGwiLCJldmVudHMiLCJpbml0IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwid3JhcCIsIml0ZW1zIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsInRvdGFsIiwiY2xhc3NMaXN0IiwiYWRkIiwiaW5pdFNpemUiLCJhZGRTbGlkZSIsImNyZWF0ZVBhZ2luYXRpb24iLCJpbml0UG9zIiwiYXV0b0hpZGVCdG4iLCJfdGhpcyIsInN0eWxlIiwiaXRlbVNpemUiLCJfdGhpczIiLCJoZWFkZXJzIiwic2xpY2UiLCJpbnNlcnRCZWZvcmUiLCJjbG9uZU5vZGUiLCJmaXJzdENoaWxkIiwidiIsImFwcGVuZENoaWxkIiwicG9zIiwiYmluZEV2ZW50Iiwic2V0UG9zaXRpb24iLCJzZXRUcmFuc2l0aW9uVGltZSIsInR5cGUiLCJmbiIsIl9mbiIsIm1vekhpZGRlbiIsIl9sZW4iLCJhcmd1bWVudHMiLCJhcmciLCJfa2V5IiwiYmluZCIsImFwcGx5IiwiY29uY2F0IiwiYWRkRXZlbnRMaXN0ZW5lciIsInB1c2giLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiX3RoaXMzIiwiZXZlbnRDb250cm9sIiwic2xpZGVQcmV2Iiwic2xpZGVOZXh0Iiwic2Nyb2xsU2xpZGUiLCJzbGlkZUVuZCIsInRpbWVyIiwic2V0SW50ZXJ2YWwiLCJzbGlkZSIsInNoaWZ0IiwiZGVzdG9yeUV2ZW50IiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwiZGlyIiwiY2xlYXJJbnRlcnZhbCIsInN0YXR1cyIsInNldFBhZ2luYXRpb25BY3RpdmUiLCJlIiwiX3RoaXM0IiwiZGVsdGEiLCJ3aGVlbERlbHRhIiwiZGV0YWlsIiwicHJldmVudERlZmF1bHQiLCJtb3VzZXdoZWVsVGltZXIiLCJjdXJEZWx0YSIsInNldFRpbWVvdXQiLCJfdGhpczUiLCJpc0VuZCIsIm9mZnNldFdpZHRoIiwibW92ZURpc3RhbmNlIiwidHJhbnNmb3JtIiwid2Via2l0VHJhbnNmb3JtIiwidGltZSIsInRyYW5zaXRpb25EdXJhdGlvbiIsIndlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiIsInJlbW92ZSIsImNsYXNzTmFtZSIsInBhZ2VzIiwiY3JlYXRlRWxlbWVudCIsInN0ciIsImlubmVySFRNTCIsImNsaWNrUGFnaW5hdGlvbiIsImN1ckJ1bGxldCIsImNoaWxkcmVuIiwiY29udGFpbnMiLCJwcmV2aW91c1NpYmxpbmciLCJzbGlkZVRvIiwiZW50cnkiLCJzZWxlY3RvciIsImNyZWF0ZUNhcm91c2VsIiwiY2Fyb3VzZWwiLCJlbGVtcyIsImNvbnNvbGUiLCJsb2ciXSwibWFwcGluZ3MiOiJBQUFBQSxRQUFRLFdBQVksU0FBVUMsR0FBOUIsWUFPQyxTQUFTQyxHQUFnQkMsRUFBVUMsR0FD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QixNQUFJQSxHQUFLc0csU0FDRHRHLEVBQUtzRyxTQUVMdEcsRUFBS3NHLFNBQVcsR0FBSXZHLEdBQVNDLEVBQU1DLEdBVDVDLEdBQUlzRyxHQUFRL0YsU0FBU00saUJBQWlCc0YsRUFFdEMsT0FEQUksU0FBUUMsSUFBSUwsR0FDUyxJQUFqQkcsRUFBTXBJLE9BQXFCa0ksRUFBZUUsRUFBTSxJQUM3QzNGLE1BQU1DLEtBQUswRixFQUFPRixHQW1IekIvSSxHQUFBQSxXQXhHYzZJIiwiZmlsZSI6InBsdWdpbnMvY2Fyb3VzZWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5sZXQgX2RlZmF1bHQgPSB7XHJcblx0Y291bnQ6IDEsXHJcblx0c2xpZGVUaW1lOiAwLjI1LFxyXG5cdGF1dG9UaW1lcjogMCxcclxuXHRyZXZlcnNlOiB0cnVlLFxyXG5cdHdpZHRoOiB1bmRlZmluZWQsXHJcblx0aGVpZ2h0OiB1bmRlZmluZWQsXHJcblx0ZGlyZWN0aW9uOiAnaG9yaXpvbnRhbCcsXHJcblx0aXNMb29wOiBmYWxzZSxcclxuXHRhdXRvSGlkZTogJ2hpZGUnLFxyXG5cdHByZXZCdG46IHVuZGVmaW5lZCxcclxuXHRuZXh0QnRuOiB1bmRlZmluZWQsXHJcblx0aW5kZXg6IDAsXHJcblx0cGFnaW5hdGlvbjogdHJ1ZSxcclxuXHRtb3VzZXdoZWVsOiBmYWxzZSxcclxuXHRwcmVTbGlkZUZuOiBudWxsLFxyXG5cdHN0YXJ0U2xpZGVGbjogbnVsbCxcclxuXHRjYWxsYmFjazogbnVsbCxcclxufVxyXG5cclxuY2xhc3MgQ2Fyb3VzZWwge1xyXG5cdGNvbnN0cnVjdG9yKGVsZW0sIG9wdGlvbikge1xyXG5cdFx0T2JqZWN0LmFzc2lnbih0aGlzLCBfZGVmYXVsdCwgb3B0aW9uKTtcclxuXHRcdHRoaXMuaXRlbUluZGV4ID0gdGhpcy5pc0xvb3AgPyAodGhpcy5jb3VudCArIHRoaXMuaW5kZXgpIDogdGhpcy5pbmRleDtcclxuXHRcdHRoaXMuaXNTY3JvbGwgPSBmYWxzZTtcclxuXHRcdHRoaXMuZXZlbnRzID0gW107XHJcblx0XHR0aGlzLmluaXQoZWxlbSk7XHJcblx0fVxyXG5cdGluaXQoZWxlbSkge1xyXG5cdFx0dGhpcy5lbGVtID0gZWxlbTtcclxuXHRcdHRoaXMucHJldkJ0biA9IHRoaXMucHJldkJ0biA/IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5wcmV2QnRuKSA6IGVsZW0ucXVlcnlTZWxlY3RvcignLmNhcm91c2VsLXByZXZCdG4nKTtcclxuXHRcdHRoaXMubmV4dEJ0biA9IHRoaXMubmV4dEJ0biA/IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5uZXh0QnRuKSA6IGVsZW0ucXVlcnlTZWxlY3RvcignLmNhcm91c2VsLW5leHRCdG4nKTtcclxuXHRcdHRoaXMud3JhcCA9IGVsZW0ucXVlcnlTZWxlY3RvcignLmNhcm91c2VsLXdyYXAnKTtcclxuXHRcdHRoaXMuaXRlbXMgPSBBcnJheS5mcm9tKHRoaXMud3JhcC5xdWVyeVNlbGVjdG9yQWxsKCcuY2Fyb3VzZWwtc2xpZGUnKSk7XHJcblx0XHR0aGlzLnRvdGFsID0gdGhpcy5pdGVtcy5sZW5ndGg7XHJcblx0XHR0aGlzLmVsZW0uY2xhc3NMaXN0LmFkZCh0aGlzLmRpcmVjdGlvbiA9PT0gJ2hvcml6b250YWwnID8gJ2Nhcm91c2VsLWhvcml6b250YWwnIDogJ2Nhcm91c2VsLXZlcnRpY2FsJyk7XHJcblxyXG5cdFx0dGhpcy5pbml0U2l6ZSgpO1xyXG5cdFx0dGhpcy5pc0xvb3AgJiYgdGhpcy5hZGRTbGlkZSgpO1xyXG5cdFx0dGhpcy5wYWdpbmF0aW9uICYmIHRoaXMuY3JlYXRlUGFnaW5hdGlvbigpO1xyXG5cdFx0dGhpcy5pbml0UG9zKCk7XHJcblx0XHR0aGlzLmF1dG9IaWRlICYmIHRoaXMuYXV0b0hpZGVCdG4oKTtcclxuXHR9XHJcblx0aW5pdFNpemUoKSB7XHJcblx0XHRpZiAodGhpcy53aWR0aCkge1xyXG5cdFx0XHR0aGlzLmVsZW0uc3R5bGUud2lkdGggPSB0eXBlb2YgdGhpcy53aWR0aCA9PT0gJ251bWJlcicgPyAodGhpcy53aWR0aCArICdweCcpIDogdGhpcy53aWR0aDtcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLmhlaWdodCkge1xyXG5cdFx0XHR0aGlzLmVsZW0uc3R5bGUuaGVpZ2h0ID0gdHlwZW9mIHRoaXMuaGVpZ2h0ID09PSAnbnVtYmVyJyA/ICh0aGlzLmhlaWdodCArICdweCcpIDogdGhpcy5oZWlnaHQ7XHJcblx0XHR9XHJcblx0XHR0aGlzLml0ZW1TaXplID0gKDEwMCAvIHRoaXMuY291bnQpICsgJyUnO1xyXG5cdFx0QXJyYXkuZnJvbSh0aGlzLml0ZW1zLCAoZWxlbSkgPT4gZWxlbS5zdHlsZVsnZmxleC1iYXNpcyddID0gdGhpcy5pdGVtU2l6ZSk7XHJcblx0fVxyXG5cdGFkZFNsaWRlKCkge1xyXG5cdFx0bGV0IGhlYWRlcnMgPSB0aGlzLml0ZW1zLnNsaWNlKHRoaXMudG90YWwgLSB0aGlzLmNvdW50KTtcclxuXHRcdGZvciAobGV0IGkgPSBoZWFkZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcblx0XHRcdHRoaXMud3JhcC5pbnNlcnRCZWZvcmUoaGVhZGVyc1tpXS5jbG9uZU5vZGUodHJ1ZSksIHRoaXMud3JhcC5maXJzdENoaWxkKVxyXG5cdFx0fVxyXG5cdFx0QXJyYXkuZnJvbSh0aGlzLml0ZW1zLnNsaWNlKDAsIHRoaXMuY291bnQpLCAodikgPT4gdGhpcy53cmFwLmFwcGVuZENoaWxkKHYuY2xvbmVOb2RlKHRydWUpKSk7XHJcblx0fVxyXG5cdGluaXRQb3MoKSB7XHJcblx0XHR0aGlzLnBvcyA9IC10aGlzLml0ZW1JbmRleDtcclxuXHRcdHRoaXMuYmluZEV2ZW50KCk7XHJcblx0XHR0aGlzLnNldFBvc2l0aW9uKCk7XHJcblx0XHR0aGlzLnNldFRyYW5zaXRpb25UaW1lKHRoaXMuc2xpZGVUaW1lKTtcclxuXHR9XHJcblx0ZXZlbnRDb250cm9sKGVsZW0sIHR5cGUsIGZuLCAuLi5hcmcpIHtcclxuXHRcdGlmICh0eXBlID09PSBcIm1vdXNld2hlZWxcIiAmJiBkb2N1bWVudC5tb3pIaWRkZW4gIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0eXBlID0gXCJET01Nb3VzZVNjcm9sbFwiO1xyXG5cdFx0fVxyXG5cdFx0Zm4gPSBmbi5iaW5kKHRoaXMsIC4uLmFyZyk7XHJcblx0XHRlbGVtLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZm4sIGZhbHNlKTtcclxuXHRcdHRoaXMuZXZlbnRzLnB1c2goKCkgPT4gZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGZuLCBmYWxzZSkpO1xyXG5cdH1cclxuXHRiaW5kRXZlbnQoKSB7XHJcblx0XHR0aGlzLnByZXZCdG4gJiYgdGhpcy5ldmVudENvbnRyb2wodGhpcy5wcmV2QnRuLCAnY2xpY2snLCB0aGlzLnNsaWRlUHJldik7XHJcblx0XHR0aGlzLm5leHRCdG4gJiYgdGhpcy5ldmVudENvbnRyb2wodGhpcy5uZXh0QnRuLCAnY2xpY2snLCB0aGlzLnNsaWRlTmV4dCk7XHJcblx0XHR0aGlzLm1vdXNld2hlZWwgJiYgdGhpcy5ldmVudENvbnRyb2wodGhpcy53cmFwLCAnbW91c2V3aGVlbCcsIHRoaXMuc2Nyb2xsU2xpZGUpO1xyXG5cdFx0dGhpcy5ldmVudENvbnRyb2wodGhpcy53cmFwLCAndHJhbnNpdGlvbmVuZCcsIHRoaXMuc2xpZGVFbmQpO1xyXG5cdFx0aWYgKHRoaXMuYXV0b1RpbWVyKSB7XHJcblx0XHRcdHRoaXMudGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzLnNsaWRlKHRoaXMucmV2ZXJzZSA/IDEgOiAtMSwgJ2F1dG8nKSwgdGhpcy5hdXRvVGltZXIpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRkZXN0b3J5RXZlbnQoKSB7XHJcblx0XHR3aGlsZSh0aGlzLmV2ZW50cy5sZW5ndGgpe1xyXG5cdFx0XHQodGhpcy5ldmVudHMuc2hpZnQoKSkoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0ZGVzdG9yeSgpIHtcclxuXHRcdHRoaXMuZGVzdG9yeUV2ZW50KCk7XHJcblx0XHR0aGlzLmVsZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW0pO1xyXG5cdH1cclxuXHRzbGlkZShkaXIsIHR5cGUpIHtcclxuXHRcdGlmICghZGlyIHx8IHRoaXMuaXNTY3JvbGwpIHtcclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMucHJlU2xpZGVGbiAmJiAhdGhpcy5wcmVTbGlkZUZuKHRoaXMpKSB7XHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH1cclxuXHRcdGlmICh0eXBlID09PSAnY2xpY2snKSB7XHJcblx0XHRcdGNsZWFySW50ZXJ2YWwodGhpcy50aW1lcik7XHJcblx0XHRcdHRoaXMudGltZXIgPSBudWxsO1xyXG5cdFx0fVxyXG5cdFx0aWYgKCF0aGlzLmlzTG9vcCkge1xyXG5cdFx0XHRsZXQgc3RhdHVzID0gdGhpcy5pdGVtSW5kZXggLSBkaXI7XHJcblx0XHRcdGlmIChzdGF0dXMgPj0gdGhpcy50b3RhbCB8fCBzdGF0dXMgPCAwKSB7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHR0aGlzLmluZGV4IC09IGRpcjtcclxuXHRcdHRoaXMuaXRlbUluZGV4IC09IGRpcjtcclxuXHRcdHRoaXMucG9zID0gdGhpcy5wb3MgKyBkaXI7XHJcblx0XHR0aGlzLmlzU2Nyb2xsID0gdHJ1ZTtcclxuXHRcdHRoaXMuc2V0UG9zaXRpb24oKTtcclxuXHRcdHRoaXMucGFnaW5hdGlvbiAmJiB0aGlzLnNldFBhZ2luYXRpb25BY3RpdmUoKTtcclxuXHRcdHRoaXMuYXV0b0hpZGUgJiYgdGhpcy5hdXRvSGlkZUJ0bigpO1xyXG5cdFx0dGhpcy5zdGFydFNsaWRlRm4gJiYgdGhpcy5zdGFydFNsaWRlRm4odGhpcyk7XHJcblx0fVxyXG5cdHNsaWRlUHJldigpIHtcclxuXHRcdHRoaXMuc2xpZGUoMSwgJ2NsaWNrJyk7XHJcblx0fVxyXG5cdHNsaWRlTmV4dCgpIHtcclxuXHRcdHRoaXMuc2xpZGUoLTEsICdjbGljaycpO1xyXG5cdH1cclxuXHRzY3JvbGxTbGlkZShlKSB7XHJcblx0XHRsZXQgZGVsdGEsIHR5cGUgPSBlLnR5cGU7XHJcblx0XHRpZiAodHlwZSA9PSAnRE9NTW91c2VTY3JvbGwnIHx8IHR5cGUgPT0gJ21vdXNld2hlZWwnKSB7XHJcblx0XHRcdGRlbHRhID0gKGUud2hlZWxEZWx0YSkgPyBlLndoZWVsRGVsdGEgLyAxMjAgOiAtKGUuZGV0YWlsIHx8IDApIC8gMztcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLmlzU2Nyb2xsIHx8IHRoaXMuaXNMb29wIHx8ICghdGhpcy5pc0xvb3AgJiYgKCh0aGlzLml0ZW1JbmRleCAhPT0gdGhpcy50b3RhbCAtIHRoaXMuY291bnQgJiYgZGVsdGEgPCAwKSB8fCAodGhpcy5pdGVtSW5kZXggIT09IDAgJiYgZGVsdGEgPiAwKSkpKSB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdH1cclxuXHRcdGlmICgrdGhpcy5tb3VzZXdoZWVsID09PSAxKSByZXR1cm4gdGhpcy5zbGlkZShkZWx0YSwgJ2NsaWNrJyk7XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0aWYgKHRoaXMubW91c2V3aGVlbFRpbWVyKSB7XHJcblx0XHRcdFx0dGhpcy5jdXJEZWx0YSArPSBkZWx0YTtcclxuXHRcdFx0XHRpZiAodGhpcy5jdXJEZWx0YSA9PT0gZGVsdGEgKiArKHRoaXMubW91c2V3aGVlbCkpIHtcclxuXHRcdFx0XHRcdHRoaXMuc2xpZGUoZGVsdGEsICdjbGljaycpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHR0aGlzLmN1ckRlbHRhID0gZGVsdGE7XHJcblx0XHRcdFx0dGhpcy5tb3VzZXdoZWVsVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuXHRcdFx0XHRcdHRoaXMuY3VyRGVsdGEgPSAwO1xyXG5cdFx0XHRcdFx0dGhpcy5tb3VzZXdoZWVsVGltZXIgPSBudWxsO1xyXG5cdFx0XHRcdH0sIDMwMCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0c2xpZGVUbyhpbmRleCkge1xyXG5cdFx0aW5kZXggPSAoaW5kZXggKyB0aGlzLnRvdGFsKSAlIHRoaXMudG90YWw7XHJcblx0XHRpZiAoaW5kZXggPT09IHRoaXMuaW5kZXgpIHJldHVybiBmYWxzZTtcclxuXHRcdHRoaXMuc2xpZGUodGhpcy5pbmRleCAtIGluZGV4LCAnY2xpY2snKTtcclxuXHR9XHJcblx0c2xpZGVFbmQoKSB7XHJcblx0XHRpZiAodGhpcy5hdXRvVGltZXIgJiYgIXRoaXMudGltZXIpIHtcclxuXHRcdFx0dGhpcy50aW1lciA9IHNldEludGVydmFsKCgpID0+IHRoaXMuc2xpZGUodGhpcy5yZXZlcnNlID8gMSA6IC0xLCAnYXV0bycpLCB0aGlzLmF1dG9UaW1lcik7XHJcblx0XHR9XHJcblx0XHRsZXQgc3RhdHVzID0gdGhpcy5pc0VuZCgpO1xyXG5cdFx0aWYgKHRoaXMuaXNMb29wICYmIHN0YXR1cykge1xyXG5cdFx0XHRpZiAoc3RhdHVzID09PSAxKSB7XHJcblx0XHRcdFx0dGhpcy5wb3MgPSAtdGhpcy50b3RhbDtcclxuXHRcdFx0XHR0aGlzLml0ZW1JbmRleCA9IHRoaXMudG90YWw7XHJcblx0XHRcdFx0dGhpcy5pbmRleCA9IHRoaXMudG90YWwgLSAxO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMucG9zID0gLXRoaXMuY291bnQ7XHJcblx0XHRcdFx0dGhpcy5pdGVtSW5kZXggPSB0aGlzLmNvdW50O1xyXG5cdFx0XHRcdHRoaXMuaW5kZXggPSAwO1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMuc2V0VHJhbnNpdGlvblRpbWUoMCk7XHJcblx0XHRcdHRoaXMuc2V0UG9zaXRpb24oKTtcclxuXHRcdFx0dGhpcy5lbGVtLm9mZnNldFdpZHRoO1xyXG5cdFx0XHR0aGlzLnNldFRyYW5zaXRpb25UaW1lKHRoaXMuc2xpZGVUaW1lKTtcclxuXHRcdH1cclxuXHRcdHRoaXMuaXNTY3JvbGwgPSBmYWxzZTtcclxuXHRcdHRoaXMuY2FsbGJhY2sgJiYgdGhpcy5jYWxsYmFjayh0aGlzKTtcclxuXHR9XHJcblx0c2V0UG9zaXRpb24oKSB7XHJcblx0XHRsZXQgbW92ZURpc3RhbmNlID0gdGhpcy5wb3MgKiAoMTAwIC8gdGhpcy5jb3VudCk7XHJcblx0XHRsZXQgdHJhbnNmb3JtID0gdGhpcy5kaXJlY3Rpb24gPT09ICdob3Jpem9udGFsJyA/ICd0cmFuc2xhdGUzZCgnICsgbW92ZURpc3RhbmNlICsgJyUsIDAlLCAwKScgOiAndHJhbnNsYXRlM2QoMCUsICcgKyBtb3ZlRGlzdGFuY2UgKyAnJSwgMCknO1xyXG5cdFx0dGhpcy53cmFwLnN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTtcclxuXHRcdHRoaXMud3JhcC5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSB0cmFuc2Zvcm07XHJcblx0fVxyXG5cdHNldFRyYW5zaXRpb25UaW1lKHRpbWUpIHtcclxuXHRcdHRoaXMud3JhcC5zdHlsZS50cmFuc2l0aW9uRHVyYXRpb24gPSB0aW1lICsgJ3MnO1xyXG5cdFx0dGhpcy53cmFwLnN0eWxlLndlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiA9IHRpbWUgKyAncyc7XHJcblx0fVxyXG5cdGF1dG9IaWRlQnRuKCkge1xyXG5cdFx0aWYgKCF0aGlzLmlzTG9vcCAmJiB0aGlzLmF1dG9IaWRlKSB7XHJcblx0XHRcdGlmICh0aGlzLml0ZW1JbmRleCA9PT0gdGhpcy50b3RhbCAtIHRoaXMuY291bnQpIHtcclxuXHRcdFx0XHR0aGlzLm5leHRCdG4gJiYgdGhpcy5uZXh0QnRuLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5pdGVtSW5kZXggPT09IDApIHtcclxuXHRcdFx0XHR0aGlzLnByZXZCdG4gJiYgdGhpcy5wcmV2QnRuLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5pdGVtSW5kZXggPiAwKSB7XHJcblx0XHRcdFx0dGhpcy5wcmV2QnRuICYmIHRoaXMucHJldkJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHRoaXMuaXRlbUluZGV4IDwgdGhpcy50b3RhbCAtIHRoaXMuY291bnQpIHtcclxuXHRcdFx0XHR0aGlzLm5leHRCdG4gJiYgdGhpcy5uZXh0QnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRpc0VuZCgpIHtcclxuXHRcdGlmICh0aGlzLml0ZW1JbmRleCA9PT0gMCkge1xyXG5cdFx0XHRyZXR1cm4gMTtcclxuXHRcdH0gZWxzZSBpZiAodGhpcy5pdGVtSW5kZXggPT09ICh0aGlzLnRvdGFsICsgdGhpcy5jb3VudCkpIHtcclxuXHRcdFx0cmV0dXJuIDI7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gMDtcclxuXHR9XHJcblx0Y3JlYXRlUGFnaW5hdGlvbihjbGFzc05hbWUpIHtcclxuXHRcdHRoaXMucGFnZXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdVTCcpO1xyXG5cdFx0dGhpcy5wYWdlcy5jbGFzc05hbWUgPSBgY2Fyb3VzZWwtcGFnaW5hdGlvbiR7dHlwZW9mIHRoaXMucGFnaW5hdGlvbiA9PT0gJ3N0cmluZycgPyAoJyAnICsgdGhpcy5wYWdpbmF0aW9uKSA6ICcnfWA7XHJcblx0XHRsZXQgc3RyID0gJyc7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudG90YWw7IGkrKykge1xyXG5cdFx0XHRzdHIgKz0gYDxsaSBjbGFzcz1cImNhcm91c2VsLXBhZ2luYXRpb24tYnVsbGV0XCI+PC9saT5gO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5wYWdlcy5pbm5lckhUTUwgPSBzdHI7XHJcblx0XHR0aGlzLmVsZW0uYXBwZW5kQ2hpbGQodGhpcy5wYWdlcyk7XHJcblxyXG5cdFx0dGhpcy5ldmVudENvbnRyb2wodGhpcy5wYWdlcywgJ2NsaWNrJywgdGhpcy5jbGlja1BhZ2luYXRpb24pO1xyXG5cclxuXHRcdHRoaXMuY3VyQnVsbGV0ID0gdGhpcy5wYWdlcy5jaGlsZHJlblt0aGlzLmluZGV4XTtcclxuXHRcdHRoaXMuY3VyQnVsbGV0LmNsYXNzTGlzdC5hZGQoJ2Nhcm91c2VsLXBhZ2luYXRpb24tYnVsbGV0LWFjdGl2ZScpO1xyXG5cdH1cclxuXHRzZXRQYWdpbmF0aW9uQWN0aXZlKCkge1xyXG5cdFx0dGhpcy5jdXJCdWxsZXQuY2xhc3NMaXN0LnJlbW92ZSgnY2Fyb3VzZWwtcGFnaW5hdGlvbi1idWxsZXQtYWN0aXZlJyk7XHJcblx0XHR0aGlzLmN1ckJ1bGxldCA9IHRoaXMucGFnZXMuY2hpbGRyZW5bKHRoaXMuaW5kZXggKyB0aGlzLnRvdGFsKSAlIHRoaXMudG90YWxdO1xyXG5cdFx0dGhpcy5jdXJCdWxsZXQuY2xhc3NMaXN0LmFkZCgnY2Fyb3VzZWwtcGFnaW5hdGlvbi1idWxsZXQtYWN0aXZlJyk7XHJcblx0fVxyXG5cdGNsaWNrUGFnaW5hdGlvbihlKSB7XHJcblx0XHRsZXQgdGFyZ2V0ID0gZS50YXJnZXQ7XHJcblx0XHRpZiAoIXRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2Nhcm91c2VsLXBhZ2luYXRpb24tYnVsbGV0JykpIHJldHVybiBmYWxzZTtcclxuXHRcdHRhcmdldCA9IHRhcmdldC5wcmV2aW91c1NpYmxpbmc7XHJcblx0XHRsZXQgaSA9IDA7XHJcblx0XHR3aGlsZSAodGFyZ2V0KSB7XHJcblx0XHRcdHRhcmdldCA9IHRhcmdldC5wcmV2aW91c1NpYmxpbmc7XHJcblx0XHRcdGkrKztcclxuXHRcdH1cclxuXHRcdHRoaXMuc2xpZGVUbyhpKTtcclxuXHR9XHJcbn1cclxuXHJcbmNvbnN0IGVudHJ5ID0gKHNlbGVjdG9yLCBvcHRpb24pID0+IHtcclxuXHRsZXQgZWxlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcclxuXHRjb25zb2xlLmxvZyhzZWxlY3Rvcik7XHJcblx0aWYgKGVsZW1zLmxlbmd0aCA9PT0gMSkgcmV0dXJuIGNyZWF0ZUNhcm91c2VsKGVsZW1zWzBdKTtcclxuXHRyZXR1cm4gQXJyYXkuZnJvbShlbGVtcywgY3JlYXRlQ2Fyb3VzZWwpO1xyXG5cclxuXHRmdW5jdGlvbiBjcmVhdGVDYXJvdXNlbChlbGVtKSB7XHJcblx0XHRpZiAoZWxlbS5jYXJvdXNlbCkge1xyXG5cdFx0XHRyZXR1cm4gZWxlbS5jYXJvdXNlbDtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHJldHVybiBlbGVtLmNhcm91c2VsID0gbmV3IENhcm91c2VsKGVsZW0sIG9wdGlvbik7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBlbnRyeTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
